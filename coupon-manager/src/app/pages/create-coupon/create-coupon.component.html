<div class="form-container">
    <div class="form-header">
        <h2>Create New Coupon</h2>
        <button class="btn-secondary" (click)="onCancel()">Back to List</button>
    </div>

    <form #couponForm="ngForm" (ngSubmit)="onSubmit(couponForm)" class="coupon-form">

        <!-- Title -->
        <div class="form-group">
            <label for="title">Title *</label>
            <input id="title" type="text" name="title" [(ngModel)]="coupon.title" required minlength="5" maxlength="100"
                #title="ngModel" [class.invalid]="title.invalid && title.touched">

            @if (title.invalid && title.touched) {
            <div class="error">
                @if (title.errors?.['required']) {
                <span>Title is required</span>
                }
                @if (title.errors?.['minlength']) {
                <span>Title must be at least 5 characters</span>
                }
            </div>
            }
        </div>

        <!-- Description -->
        <div class="form-group">
            <label for="description">Description *</label>
            <textarea id="description" name="description" [(ngModel)]="coupon.description" required minlength="10"
                maxlength="500" rows="4" #description="ngModel"
                [class.invalid]="description.invalid && description.touched">
        </textarea>

            @if (description.invalid && description.touched) {
            <div class="error">
                @if (description.errors?.['required']) {
                <span>Description is required</span>
                }
                @if (description.errors?.['minlength']) {
                <span>Description must be at least 10 characters</span>
                }
            </div>
            }
        </div>

        <!-- Discount & Code Row -->
        <div class="form-row">
            <div class="form-group">
                <label for="discount">Discount (%) *</label>
                <input id="discount" type="number" name="discount" [(ngModel)]="coupon.discount" required min="1"
                    max="100" #discount="ngModel" [class.invalid]="discount.invalid && discount.touched">

                @if (discount.invalid && discount.touched) {
                <div class="error">
                    <span>Discount must be between 1 and 100</span>
                </div>
                }
            </div>

            <div class="form-group">
                <label for="code">Coupon Code *</label>
                <input id="code" type="text" name="code" [(ngModel)]="coupon.code" required minlength="4" maxlength="20"
                    pattern="[A-Z0-9]+" #code="ngModel" [class.invalid]="code.invalid && code.touched"
                    placeholder="e.g., SAVE20">

                @if (code.invalid && code.touched) {
                <div class="error">
                    @if (code.errors?.['required']) {
                    <span>Code is required</span>
                    }
                    @if (code.errors?.['pattern']) {
                    <span>Code must be uppercase letters and numbers only</span>
                    }
                </div>
                }
            </div>
        </div>

        <!-- Category & Expiry Date Row -->
        <div class="form-row">
            <div class="form-group">
                <label for="category">Category *</label>
                <select id="category" name="category" [(ngModel)]="coupon.category" required #category="ngModel"
                    [class.invalid]="category.invalid && category.touched">
                    <option value="">Select category</option>
                    @for (cat of categories; track cat) {
                    <option [value]="cat">{{ cat }}</option>
                    }
                </select>

                @if (category.invalid && category.touched) {
                <div class="error">
                    <span>Category is required</span>
                </div>
                }
            </div>

            <div class="form-group">
                <label for="expiryDate">Expiry Date *</label>
                <input id="expiryDate" type="date" name="expiryDate" [(ngModel)]="coupon.expiryDate" required
                    #expiryDate="ngModel" [class.invalid]="expiryDate.invalid && expiryDate.touched">

                @if (expiryDate.invalid && expiryDate.touched) {
                <div class="error">
                    <span>Expiry date is required</span>
                </div>
                }
            </div>
        </div>

        <!-- Usage Limit -->
        <div class="form-group">
            <label for="usageLimit">Usage Limit *</label>
            <input id="usageLimit" type="number" name="usageLimit" [(ngModel)]="coupon.usageLimit" required min="1"
                #usageLimit="ngModel" [class.invalid]="usageLimit.invalid && usageLimit.touched">

            @if (usageLimit.invalid && usageLimit.touched) {
            <div class="error">
                <span>Usage limit must be at least 1</span>
            </div>
            }
        </div>

        <!-- Is Active -->
        <div class="form-group checkbox">
            <label>
                <input type="checkbox" name="isActive" [(ngModel)]="coupon.isActive">
                <span>Active</span>
            </label>
        </div>

        <!-- Actions -->
        <div class="form-actions">
            <button type="submit" class="btn-primary" [disabled]="couponForm.invalid">
                Create Coupon
            </button>
            <button type="button" class="btn-secondary" (click)="onCancel()">
                Cancel
            </button>
        </div>

        <!-- Debug Info (Optional) -->
        <div class="debug-info">
            <p><strong>Form Valid:</strong> {{ couponForm.valid }}</p>
        </div>
    </form>
</div>